<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sleek VoFo Music Player</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        /* --- ROOT VARIABLES --- */
        :root {
            --bg-dark: #000000;
            --bg-app: #0a0a0a; /* Main background color */
            --bg-card-hover: #1c1c1c;
            --primary-accent: #745dc7; /* Dark Violet/Purple Accent */
            --secondary-accent: #f0ff40; /* Vibrant Yellow-Green for play/pause button */
            --text-white: #f3f4f6;
            --text-light: #a1a1aa;
            --border-radius: 12px;
            --player-height-desktop: 90px;
            --player-height-mobile: 150px; /* Taller for padding */
            --mobile-margin: 15px; /* Margin for the floating effect */
        }

        /* --- BASE STYLES & ANIMATED BACKGROUND --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text-white);
            overflow-x: hidden;
            scroll-behavior: smooth;
        }
        
        .animated-background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2;
            background: var(--bg-app); overflow: hidden;
        }

        /* Moving Gradient Blobs */
        .gradient-blur {
            position: absolute; width: 80vw; height: 80vh; filter: blur(150px); opacity: 0.3;
            animation: colorDance 15s ease-in-out infinite alternate;
        }

        @keyframes colorDance {
            0% { 
                transform: translate(0, 0) rotate(0deg); 
                background: radial-gradient(circle at 10% 20%, var(--primary-accent), transparent);
            }
            50% { 
                transform: translate(100px, 100px) rotate(180deg); 
                background: radial-gradient(circle at 80% 90%, #ff5722, transparent);
            }
            100% { 
                transform: translate(-50px, -50px) rotate(360deg); 
                background: radial-gradient(circle at 30% 70%, var(--secondary-accent), transparent);
            }
        }
        
        /* Main Container */
        .app-container {
            position: relative; z-index: 1; max-width: 1400px; margin: 0 auto;
            padding-bottom: var(--player-height-desktop); 
            min-height: 100vh;
        }

        /* --- TOP BAR (HEADER/SEARCH) --- */
        .top-bar {
            position: sticky; top: 0; width: 100%; height: 80px;
            background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(10px);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 40px; z-index: 5;
        }
        .top-bar h1 { color: var(--primary-accent); font-weight: 800; font-size: 24px; cursor: pointer; } 
        .search-container { width: 450px; max-width: 50%; display: flex; gap: 10px; align-items: center; position: relative; }
        #searchInput {
            flex-grow: 1; padding: 10px 20px; border-radius: 25px;
            border: 1px solid var(--bg-card-hover); background: var(--bg-card-hover);
            color: var(--text-white); font-size: 15px;
        }
        #searchBtn {
            padding: 10px 20px; border: none; border-radius: 25px;
            background: var(--primary-accent); color: var(--bg-dark);
            cursor: pointer; font-weight: 700; transition: background 0.2s;
        }

        /* Search Loading Indicator */
        .loading-line { position: absolute; bottom: -5px; left: 0; width: 100%; height: 3px; background: transparent; overflow: hidden; border-radius: 1.5px; }
        .loading-line.active { background: rgba(116, 93, 199, 0.3); }
        .loading-line.active::after { content: ''; position: absolute; top: 0; left: 0; width: 30%; height: 100%; background: var(--primary-accent); border-radius: 1.5px; animation: loadingBar 1.5s infinite linear; }
        @keyframes loadingBar { 0% { transform: translateX(-100%); } 100% { transform: translateX(333%); } }

        /* --- MAIN CONTENT & RESULTS --- */
        .main-content { padding: 40px; min-height: calc(100vh - 80px - var(--player-height-desktop) - 50px); }
        
        /* DESKTOP: Default Grid Layout */
        #results { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); 
            gap: 20px; 
            margin-top: 20px;
        }

        /* Card styles */
        .song-card {
            background: rgba(10, 10, 10, 0.4); 
            backdrop-filter: blur(5px);
            border-radius: var(--border-radius);
            padding: 15px; 
            transition: background 0.3s, transform 0.1s;
            display: flex; flex-direction: column; 
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .song-card img { width: 100%; aspect-ratio: 1/1; object-fit: cover; border-radius: 8px; margin-bottom: 10px; }
        .song-info .title { font-weight: 700; font-size: 16px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .song-info .artist { font-size: 13px; color: var(--text-light); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

        /* --- PLAYER BAR (DESKTOP) --- */
        .player-bar {
            position: fixed; bottom: 0; left: 0; right: 0; 
            height: var(--player-height-desktop);
            background: rgba(10, 10, 10, 0.9); 
            backdrop-filter: blur(25px); 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 0 40px; 
            box-shadow: 0 -5px 25px rgba(0,0,0,0.7);
            z-index: 100;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Track Info (Desktop) */
        .current-track-info {
            width: 25%;
            display: flex; 
            align-items: center; 
            gap: 15px; 
            min-width: 200px;
        }

        /* Thumbnail style (Desktop) */
        #playerAlbumArt {
            width: 60px; height: 60px; object-fit: cover; border-radius: 8px;
            border: 2px solid var(--primary-accent); flex-shrink: 0;
        }
        
        /* Controls (Desktop) */
        .player-bar button { 
            background: none; border: none; color: var(--text-light); font-size: 20px; 
            padding: 0; width: 30px; height: 30px; cursor: pointer; 
            transition: color 0.2s, transform 0.1s;
            display: flex; justify-content: center; align-items: center;
        }
        .player-bar button:hover {
            color: var(--primary-accent); 
            transform: scale(1.05);
        }

        .center-player { display: flex; flex-direction: column; align-items: center; flex-grow: 1; max-width: 600px; }
        .center-player .controls { margin-bottom: 5px; display: flex; gap: 30px; }
        .progress-container { display: flex; align-items: center; width: 100%; gap: 10px; }
        /* Time Display (Visible on Desktop) */
        .time-display { font-size: 12px; color: var(--text-light); width: 40px; text-align: center; }
        #playPauseBtn { font-size: 36px; color: var(--secondary-accent); }
        #playPauseBtn:hover { color: var(--text-white); transform: scale(1.1); } 

        /* Custom Range Slider (Progress Bar) */
        .progress-bar-input { -webkit-appearance: none; appearance: none; width: 100%; height: 6px; border-radius: 3px; background: linear-gradient(to right, var(--primary-accent) 0%, var(--primary-accent) 0%, #2d2d2d 0%, #2d2d2d 100%); cursor: pointer; }
        .progress-bar-input::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 14px; height: 14px; border-radius: 50%; background: var(--primary-accent); cursor: pointer; box-shadow: 0 0 5px rgba(0,0,0,0.5); }
        
        /* Volume Controls */
        .volume-container { display: flex; align-items: center; gap: 10px; width: 150px; justify-content: flex-end; }

        /* --- FOOTER --- */
        .app-footer { text-align: center; padding: 15px 40px; font-size: 12px; color: var(--text-light); background: rgba(0, 0, 0, 0.3); border-top: 1px solid rgba(255, 255, 255, 0.05); margin-top: 20px; position: relative; z-index: 1; }

        /* --- MOBILE SPECIFIC STYLES (Max-width: 768px) --- */
        @media (max-width: 768px) {
            
            /* Hide Time Displays on Mobile Slider */
            .progress-container .time-display {
                display: none;
            }

            /* General Layout */
            .app-container { 
                padding-bottom: calc(var(--player-height-mobile) + (var(--mobile-margin) * 2)); 
            }
            .main-content { 
                min-height: calc(100vh - 100px - var(--player-height-mobile) - 30px);
                padding: 15px; padding-top: 110px; 
            }
            .top-bar { padding: 0 15px; height: 100px; flex-direction: column; justify-content: space-around; }

            /* Mobile Card Layout: Two columns */
            #results { 
                grid-template-columns: repeat(2, 1fr); 
                gap: 10px; 
            }
            
            /* Player Bar - Floating and Rounded */
            .player-bar { 
                bottom: var(--mobile-margin); 
                left: var(--mobile-margin); 
                right: var(--mobile-margin); 
                width: auto; 

                height: var(--player-height-mobile); 
                flex-direction: column; 
                padding: 10px 15px; 
                justify-content: space-between; 

                border-radius: 20px; 
                backdrop-filter: blur(40px); 
                background: rgba(10, 10, 10, 0.85); 
                border-top: none; 
                box-shadow: 0 0 30px rgba(0,0,0,0.5); 
            }
            
            /* Track Info - Top Left Alignment */
            .current-track-info {
                width: 100%; 
                justify-content: flex-start; /* Aligned to the LEFT */
                order: 1; 
                margin-bottom: 5px; 
            }
            /* Thumbnail - now 50px for a more compact look */
            .current-track-info #playerAlbumArt {
                width: 50px; 
                height: 50px;
                border-radius: 6px; 
            }
            .current-track-details .title { font-size: 15px; } 
            .current-track-details .artist { font-size: 12px; }

            /* Center Player - Full width */
            .center-player { max-width: 100%; width: 100%; }

            /* Progress container (The slider) - Middle/Top of the lower section */
            .progress-container { 
                order: 2; 
                margin-bottom: 10px; 
                padding-top: 0;
            }
            
            /* Controls section - Bottom */
            .center-player .controls { 
                order: 3; 
                margin-top: 0px; 
                margin-bottom: 0; 
                gap: 50px; 
            }

            .volume-container { display: none; }
        }
    </style>
</head>
<body>

    <div class="animated-background">
        <div class="gradient-blur" style="top: 0; left: 0; animation-delay: -3s;"></div>
        <div class="gradient-blur" style="bottom: 0; right: 0; opacity: 0.2; animation-delay: -8s; background: radial-gradient(circle at 80% 90%, #ff5722, transparent);"></div>
    </div>

    <div class="app-container">
        
        <div class="top-bar">
            <h1 onclick="activateEasterEgg()">VoFo Music</h1>
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Search for songs">
                <button id="searchBtn" onclick="searchSongs()">Search</button>
                <div class="loading-line" id="loadingLine"></div>
            </div>
        </div>

        <div class="main-content">
            <h2 style="color: var(--text-light); font-weight: 500; margin-bottom: 10px;" id="sectionTitle">
                Enter a song, artist, or genre above
            </h2>
            <div id="results">
                </div>
        </div>

        <footer class="app-footer">
            &copy; 2025 VoFo Music. All rights reserved. | Built with passion.
        </footer>

        <div class="player-bar hidden" id="playerBar">
            <div class="current-track-info">
                <img id="playerAlbumArt" src="https://placehold.co/60x60/1e293b/f3f4f6?text=Art" alt="Album Art">
                <div class="current-track-details">
                    <div class="title" id="playerTitle">No track loaded</div>
                    <div class="artist" id="playerArtist">VoFo Music</div>
                </div>
            </div>

            <div class="center-player">
                <div class="progress-container">
                    <span class="time-display" id="currentTime">0:00</span>
                    <input type="range" id="progressBar" class="progress-bar-input" min="0" max="0" value="0" step="1">
                    <span class="time-display" id="totalTime">0:00</span>
                </div>
                <div class="controls">
                    <button title="Previous"><i class="fas fa-step-backward"></i></button>
                    <button id="playPauseBtn" title="Play/Pause"><i class="fas fa-play"></i></button>
                    <button title="Next"><i class="fas fa-step-forward"></i></button>
                </div>
            </div>

            <div class="volume-container">
                <i class="volume-icon fas fa-volume-high" id="volumeIcon"></i>
                <input type="range" id="volumeSlider" class="progress-bar-input" min="0" max="1" step="0.01" value="0.8">
            </div>
        </div>

        <audio id="audioElement" playsinline></audio>

    </div>

    <script>
        // Use a placeholder for your actual API base path.
        const API_BASE = ""; 

        // --- DOM Elements ---
        const searchInput = document.getElementById("searchInput");
        const resultsDiv = document.getElementById("results");
        const audio = document.getElementById("audioElement");

        const loadingLine = document.getElementById("loadingLine");
        const playerBar = document.getElementById("playerBar");
        const playPauseBtn = document.getElementById("playPauseBtn");
        const playerTitle = document.getElementById("playerTitle");
        const playerArtist = document.getElementById("playerArtist");
        const playerAlbumArt = document.getElementById("playerAlbumArt");
        const progressBar = document.getElementById("progressBar");
        const currentTimeDisplay = document.getElementById("currentTime");
        const totalTimeDisplay = document.getElementById("totalTime");
        const volumeSlider = document.getElementById("volumeSlider");

        // --- State ---
        let currentTrack = null;
        let progressInterval;
        let easterEggCounter = 0; 

        // --- Utility Functions ---

        function formatTime(seconds) {
            if (isNaN(seconds) || seconds < 0) return '0:00';
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            const paddedSeconds = remainingSeconds < 10 ? '0' + remainingSeconds : remainingSeconds;
            return `${minutes}:${paddedSeconds}`;
        }
        
        function updateProgressBarAppearance(value, duration) {
            const percentage = (value / duration) * 100 || 0;
            const dynamicColor = getComputedStyle(document.documentElement).getPropertyValue('--primary-accent').trim();
            
            progressBar.style.background = `linear-gradient(to right, ${dynamicColor} 0%, ${dynamicColor} ${percentage}%, #2d2d2d ${percentage}%, #2d2d2d 100%)`;
        }

        function updateVolumeBarAppearance() {
            const percentage = (volumeSlider.value / volumeSlider.max) * 100;
            const dynamicColor = getComputedStyle(document.documentElement).getPropertyValue('--primary-accent').trim();
            
            volumeSlider.style.background = `linear-gradient(to right, ${dynamicColor} 0%, ${dynamicColor} ${percentage}%, #2d2d2d ${percentage}%, #2d2d2d 100%)`;
        }
        
        // --- EASTER EGG FUNCTION ---
        function activateEasterEgg() {
            easterEggCounter++;
            if (easterEggCounter >= 5) { 
                alert("ðŸŽ‰ Easter Egg Activated! ðŸŽ‰ The primary color palette has been flipped.");
                document.documentElement.style.setProperty('--primary-accent', '#18FFFF'); // New cyan
                document.documentElement.style.setProperty('--secondary-accent', '#FF4081'); // New pink
                
                easterEggCounter = 0; 

                updateVolumeBarAppearance();
                updateProgressBarAppearance(audio.currentTime, audio.duration);
            } else {
                console.log(`Easter Egg progress: ${easterEggCounter}/5 clicks.`);
            }
        }
        window.activateEasterEgg = activateEasterEgg; // Expose globally


        // --- Core Functions ---

        async function searchSongs() {
            const query = searchInput.value;
            if (!query) return;

            loadingLine.classList.add("active");
            resultsDiv.innerHTML = "";

            try {
                // Original API call preserved
                const res = await fetch(`${API_BASE}/api/search?q=${encodeURIComponent(query)}`);
                const data = await res.json();

                loadingLine.classList.remove("active");
                
                if (data.length === 0) {
                    resultsDiv.innerHTML = `<p style="color:var(--text-light); text-align:center;">No results found for "${query}".</p>`;
                    return;
                }

                data.forEach(song => {
                    const div = document.createElement("div");
                    div.className = "song-card";

                    div.innerHTML = `
                        <img src="${song.thumbnail}" alt="${song.title} thumbnail">
                        <div class="song-info">
                            <div class="title">${song.title}</div>
                            <div class="artist">${song.composer}</div>
                        </div>
                    `;
                    div.dataset.videoId = song.id;
                    div.dataset.title = song.title;
                    div.dataset.composer = song.composer;
                    div.dataset.thumbnail = song.thumbnail;
                    
                    div.addEventListener("click", () => playTrack(song)); 
                    resultsDiv.appendChild(div);
                });

            } catch (err) {
                loadingLine.classList.remove("active");
                resultsDiv.innerHTML = `<p style="color:#cc3333; text-align:center;">Error fetching results: ${err.message}</p>`;
                console.error("Search error:", err);
            }
        }
        window.searchSongs = searchSongs; // Expose globally

        async function playTrack(song) {
            const videoId = song.id;
            
            playerBar.classList.remove('hidden');
            playerTitle.textContent = song.title;
            playerArtist.textContent = song.composer;
            playerAlbumArt.src = song.thumbnail;
            currentTrack = song;

            // Immediately set to pause state (no spinning) while loading
            playPauseBtn.querySelector('i').className = "fas fa-pause"; 
            audio.pause();
            audio.src = '';

            try {
                const res = await fetch(`${API_BASE}/api/play`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ video_id: videoId })
                });
                const data = await res.json();

                if (data.error) throw new Error(data.error);

                audio.src = data.url; 
                await audio.play();

            } catch (err) {
                console.error("Playback error:", err);
                alert("Playback failed. Tap anywhere to manually enable audio playback!");
                playPauseBtn.querySelector('i').className = "fas fa-play";
            }
        }


        // --- Player Control Functions ---

        function togglePlayPause() {
            if (!audio.src) {
                alert("Please search and select a song first!");
                return;
            }
            if (audio.paused) {
                audio.play();
            } else {
                audio.pause();
            }
        }
        
        function updateProgress() {
            const current = audio.currentTime;
            const duration = audio.duration;

            if (!isNaN(duration) && isFinite(duration)) {
                progressBar.max = duration;
                progressBar.value = current;
                currentTimeDisplay.textContent = formatTime(current);
                totalTimeDisplay.textContent = formatTime(duration);
                updateProgressBarAppearance(current, duration);
            }
        }


        // --- Event Listeners ---

        playPauseBtn.addEventListener('click', togglePlayPause);
        searchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') searchSongs();
        });

        // Audio Events
        audio.onplay = () => {
            playPauseBtn.querySelector('i').className = "fas fa-pause";
            progressInterval = setInterval(updateProgress, 1000);
        };

        audio.onpause = () => {
            playPauseBtn.querySelector('i').className = "fas fa-play";
            clearInterval(progressInterval);
        };

        audio.onloadedmetadata = () => {
            if (!isNaN(audio.duration) && isFinite(audio.duration)) {
                progressBar.max = audio.duration;
                totalTimeDisplay.textContent = formatTime(audio.duration);
                updateProgressBarAppearance(audio.currentTime, audio.duration);
            }
        };

        audio.ontimeupdate = updateProgress;
        audio.onended = () => {
            playPauseBtn.querySelector('i').className = "fas fa-redo"; 
            progressBar.value = 0;
            currentTimeDisplay.textContent = '0:00';
            updateProgressBarAppearance(0, progressBar.max);
        };

        // Progress Bar Dragging
        progressBar.oninput = () => {
            clearInterval(progressInterval); 
            currentTimeDisplay.textContent = formatTime(progressBar.value);
            updateProgressBarAppearance(progressBar.value, progressBar.max);
        };

        progressBar.onchange = () => {
            audio.currentTime = progressBar.value;
            progressInterval = setInterval(updateProgress, 1000); 
        };

        // Volume Slider
        volumeSlider.oninput = () => {
            audio.volume = volumeSlider.value;
            updateVolumeBarAppearance();
        };

        // Initial setup
        document.addEventListener('DOMContentLoaded', () => {
            audio.volume = volumeSlider.value;
            updateVolumeBarAppearance();
            updateProgressBarAppearance(0, 100);
        });

    </script>

</body>
</html>
